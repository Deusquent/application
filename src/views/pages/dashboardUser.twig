{% extends '../layouts/base.twig' %}

{% block content %}
    <div class="dashboard-layout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="/dashboardUser" class="active">Tableau de bord</a>
                <a href="/mes-vehicules">Mes v√©hicules</a>
                <a href="/calendar">Rendez-vous</a>
                <a href="/documents">Documents</a>
                <a href="/parametres">Param√®tres</a>
            </nav>
            
            <div class="sidebar-stats">
                <div>V√©hicules
                    <span class="stat-red">{{ vehicles|length }}</span>
                </div>
                <div>Rendez-vous
                    <span class="stat-yellow">{{ rdvs|length }}</span>
                </div>
                <div>Alertes
                    <span class="stat-green">{{ alerts|default(0) }}</span>
                </div>
            </div>
            
            <!-- D√©placer les recommandations dans la sidebar -->
            <div class="sidebar-recommendations">
                <h3>Recommandations</h3>
                {% if recommendations and recommendations|length > 0 %}
                    {% for reco in recommendations %}
                        <div class="sidebar-reco-item">
                            <span class="sidebar-reco-icon">üîß</span>
                            <div class="sidebar-reco-content">
                                <p class="sidebar-reco-title">{{ reco.title }}</p>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="sidebar-no-reco">Pas de recommandations</p>
                {% endif %}
            </div>
        </aside>

        <div class="dashboard-main">
            <section class="dashboard-header">
                <h1>Tableau de bord</h1>
                <p>Bienvenue sur votre espace personnel</p>
            </section>
            
            <div class="dashboard-content-grid">
                <!-- Section V√©hicules -->
                <section class="dashboard-block vehicles-block">
                    <h2>Mes v√©hicules</h2>
                    <div class="vehicles-list">
                        {% if vehicles and vehicles|length > 0 %}
                            <div class="vehicle-grid">
                                {% for vehicle in vehicles %}
                                    <div class="vehicle-card">
                                        <div class="vehicle-icon">
                                            {% if vehicle.photo %}
                                                <img src="{{ vehicle.photo }}" alt="{{ vehicle.marque }} {{ vehicle.model }}">
                                            {% else %}
                                                <div class="vehicle-no-img">Pas de photo</div>
                                            {% endif %}
                                        </div>
                                        <div class="vehicle-info">
                                            <h3>{{ vehicle.marque }} {{ vehicle.model }}</h3>
                                            <p><strong>Type :</strong> {{ vehicle.type }}</p>
                                            <p><strong>Ann√©e :</strong> {{ vehicle.annee }}</p>
                                            <p><strong>Kilom√©trage :</strong> {{ vehicle.km }} km</p>
                                            <p><strong>Carburant :</strong> {{ vehicle.carburant }}</p>
                                            <p><strong>Bo√Æte :</strong> {{ vehicle.boite_de_vitesse }}</p>
                                            <p><strong>Immatriculation :</strong> {{ vehicle.imatriculation }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p>Aucun v√©hicule enregistr√© pour l'instant.</p>
                        {% endif %}
                    </div>
                </section>

                <!-- Section Rendez-vous -->
                <section class="dashboard-block rdv-block">
                    <h2>Rendez-vous √† venir</h2>
                    <div class="events-list">
                        {% if rdvs|length > 0 %}
                            {% for rdv in rdvs %}
                                <div class="event-card">
                                    <div class="event-date">
                                        <span>{{ rdv.formattedDate|split(' ')[0] }}</span>
                                        <span>{{ rdv.formattedDate|split(' ')[1] }}</span>
                                    </div>
                                    <div class="event-info">
                                        <h4>{{ rdv.title }}</h4>
                                        {% if rdv.location %}
                                            <p><i class="fas fa-map-marker-alt"></i> {{ rdv.location }}</p>
                                        {% endif %}
                                        <p><i class="far fa-clock"></i> {{ rdv.formattedTime }}</p>
                                        {% if rdv.vehicle %}
                                            <p><i class="fas fa-car"></i> {{ rdv.vehicle.marque }} {{ rdv.vehicle.model }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="no-events">Aucun rendez-vous pr√©vu ce mois-ci.</p>
                        {% endif %}
                    </div>
                </section>
            </div>
        </div>
    </div>
{% endblock %}